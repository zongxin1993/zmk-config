#include <dt-bindings/zmk/matrix_transform.h>
#include <physical_layouts.dtsi>

/ {
    chosen {
        zmk,kscan = &kscan0;
        zmk,physical-layout = &physical_layout0;
    };

    kscan0: kscan0 {
        compatible = "zmk,kscan-gpio-matrix";
        diode-direction = "col2row";
        wakeup-source;
        row-gpios
            = <&gpio0 10 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&gpio1 6 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&gpio0 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&gpio1 4 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            , <&gpio0 2 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>
            ;
        };
    default_transform: matrix_transform {
            compatible = "zmk,matrix-transform";
            rows = <5>;
            columns = <15>;

            map = <
                RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5) RC(0,6)            RC(0,8) RC(0,9) RC(0,10) RC(0,11) RC(0,12) RC(0,13) RC(0,14)
                RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5) RC(1,6)            RC(1,8) RC(1,9) RC(1,10) RC(1,11) RC(1,12) RC(1,13) RC(1,14)
                RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5)            RC(2,7) RC(2,8) RC(2,9) RC(2,10) RC(2,11) RC(2,12) RC(2,13)
                RC(3,0) RC(3,1) RC(3,2) RC(3,3) RC(3,4) RC(3,5)            RC(3,7) RC(3,8) RC(3,9) RC(3,10) RC(3,11) RC(3,12) RC(3,13) RC(3,14) 
                RC(4,0) RC(4,1) RC(4,2) RC(4,3)         RC(4,5)                    RC(4,8)         RC(4,10) RC(4,11) RC(4,12) RC(4,13) RC(4,14)
            >;
    };

    leds {
        compatible = "gpio-leds";
        blue_led: led_0 {
            gpios = <&gpio1 11 GPIO_ACTIVE_HIGH>;
        };
    };

    // Node name must match original "EXT_POWER" label to preserve user settings.
    EXT_POWER {
        compatible = "zmk,ext-power-generic";
        control-gpios = <&gpio0 3 GPIO_ACTIVE_LOW>;
        init-delay-ms = <50>;
    };

    vbatt: vbatt {
        compatible = "zmk,battery-voltage-divider";
        io-channels = <&adc 4>;
        output-ohms = <2000000>;
        full-ohms = <(2000000 + 820000)>;
    };

    physical_layout0: physical_layout_0 {
        compatible = "zmk,physical-layout";
        display-name = "Default Layout";

        kscan = <&kscan0>;
        transform = <&default_transform>;

        keys  //                     w   h    x    y     rot    rx    ry
            = <&key_physical_attrs 100 100    0    0       0     0     0> //ESC
            , <&key_physical_attrs 100 100   100   0       0     0     0> //1
            , <&key_physical_attrs 100 100   200   0       0     0     0> //2
            , <&key_physical_attrs 100 100   300   0       0     0     0> //3
            , <&key_physical_attrs 100 100   400   0       0     0     0> //4
            , <&key_physical_attrs 100 100   500   0       0     0     0> //5
            , <&key_physical_attrs 100 100   600   0       0     0     0> //6
            , <&key_physical_attrs 100 100   700   0       0     0     0> //7
            , <&key_physical_attrs 100 100   800   0       0     0     0> //8
            , <&key_physical_attrs 100 100   900   0       0     0     0> //9
            , <&key_physical_attrs 100 100  1000   0       0     0     0> //0
            , <&key_physical_attrs 100 100  1100   0       0     0     0> //-
            , <&key_physical_attrs 100 100  1200   0       0     0     0> //=
            , <&key_physical_attrs 200 100  1300   0       0     0     0> //Back
            , <&key_physical_attrs 150 100    0    100     0     0     0> //TAB
            , <&key_physical_attrs 100 100   150   100     0     0     0> //Q
            , <&key_physical_attrs 100 100   250   100     0     0     0> //W
            , <&key_physical_attrs 100 100   350   100     0     0     0> //E
            , <&key_physical_attrs 100 100   450   100     0     0     0> //R
            , <&key_physical_attrs 100 100   550   100     0     0     0> //T
            , <&key_physical_attrs 100 100   650   100     0     0     0> //Y
            , <&key_physical_attrs 100 100   750   100     0     0     0> //U
            , <&key_physical_attrs 100 100   850   100     0     0     0> //I
            , <&key_physical_attrs 100 100   950   100     0     0     0> //O
            , <&key_physical_attrs 100 100  1050   100     0     0     0> //P
            , <&key_physical_attrs 100 100  1150   100     0     0     0> //[
            , <&key_physical_attrs 100 100  1250   100     0     0     0> //]
            , <&key_physical_attrs 150 100  1350   100     0     0     0> //\
            , <&key_physical_attrs 175 100    0    200     0     0     0> //CAP
            , <&key_physical_attrs 100 100   175   200     0     0     0> //A
            , <&key_physical_attrs 100 100   275   200     0     0     0> //S
            , <&key_physical_attrs 100 100   375   200     0     0     0> //D
            , <&key_physical_attrs 100 100   475   200     0     0     0> //F
            , <&key_physical_attrs 100 100   575   200     0     0     0> //G
            , <&key_physical_attrs 100 100   675   200     0     0     0> //H
            , <&key_physical_attrs 100 100   775   200     0     0     0> //J
            , <&key_physical_attrs 100 100   875   200     0     0     0> //K
            , <&key_physical_attrs 100 100   975   200     0     0     0> //L
            , <&key_physical_attrs 100 100  1075   200     0     0     0> //;
            , <&key_physical_attrs 100 100  1175   200     0     0     0> //'
            , <&key_physical_attrs 225 100  1275   200     0     0     0> //ENTER
            , <&key_physical_attrs 200 100    0    300     0     0     0> //SHIFT
            , <&key_physical_attrs 100 100   200   300     0     0     0> //Z
            , <&key_physical_attrs 100 100   300   300     0     0     0> //X
            , <&key_physical_attrs 100 100   400   300     0     0     0> //C
            , <&key_physical_attrs 100 100   500   300     0     0     0> //V
            , <&key_physical_attrs 100 100   600   300     0     0     0> //B
            , <&key_physical_attrs 100 100   700   300     0     0     0> //N
            , <&key_physical_attrs 100 100   800   300     0     0     0> //M
            , <&key_physical_attrs 100 100   900   300     0     0     0> //,
            , <&key_physical_attrs 100 100  1000   300     0     0     0> //.
            , <&key_physical_attrs 100 100  1100   300     0     0     0> ///
            , <&key_physical_attrs 100 100  1200   300     0     0     0> //HOME
            , <&key_physical_attrs 100 100  1300   300     0     0     0> //UP
            , <&key_physical_attrs 100 100  1400   300     0     0     0> //MO3
            , <&key_physical_attrs 125 100    0    400     0     0     0> //CTRL
            , <&key_physical_attrs 125 100   125   400     0     0     0> //WIN
            , <&key_physical_attrs 125 100   250   400     0     0     0> //MO1
            , <&key_physical_attrs 125 100   375   400     0     0     0> //ALT
            , <&key_physical_attrs 275 100   500   400     0     0     0> //SPACE
            , <&key_physical_attrs 225 100   775   400     0     0     0> //MO2
            , <&key_physical_attrs 100 100  1000   400     0     0     0> //PGUP
            , <&key_physical_attrs 100 100  1100   400     0     0     0> //PGDW
            , <&key_physical_attrs 100 100  1200   400     0     0     0> //LIFT
            , <&key_physical_attrs 100 100  1300   400     0     0     0> //DOWN
            , <&key_physical_attrs 100 100  1400   400     0     0     0> //RIGHT
            ;
    };
};